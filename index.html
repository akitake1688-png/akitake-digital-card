<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§‹æ­¦é€»è¾‘ Â· å‡å­¦é˜²å¾¡ç³»ç»Ÿ V20</title>
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* 1:1 ç»§æ‰¿å¹¶å¢å¼º V14 çš„æ•°å­—å¡å®šä½æ ·å¼ */
        :root { --accent: #3b82f6; --text-main: #1e293b; --glass: rgba(255, 255, 255, 0.88); }
        body { background: linear-gradient(135deg, #f8fafc 0%, #cbd5e1 100%); height: 100vh; display: flex; align-items: center; justify-content: center; margin: 0; font-family: "PingFang SC", sans-serif; overflow: hidden; }
        .glass-container { width: 95vw; height: 92vh; max-width: 1100px; background: var(--glass); backdrop-filter: blur(20px); border-radius: 24px; display: flex; box-shadow: 0 40px 100px -20px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.4); overflow: hidden; }
        
        .side-panel { width: 280px; border-right: 1px solid rgba(0,0,0,0.05); padding: 30px 20px; display: flex; flex-direction: column; background: rgba(255,255,255,0.3); }
        .avatar-ring { width: 90px; height: 90px; border-radius: 50%; padding: 4px; background: linear-gradient(135deg, var(--accent), #1d4ed8); margin: 0 auto 20px; }
        .avatar-main { width: 100%; height: 100%; border-radius: 50%; border: 3px solid white; object-fit: cover; }
        
        .profile-card h2 { text-align: center; font-size: 1.3rem; color: #0f172a; margin-bottom: 8px; letter-spacing: 0.1em; }
        .bio { font-size: 0.82rem; color: #64748b; text-align: center; line-height: 1.6; }

        /* ååŒæŒ‰é’®åŒº */
        .nav-section { flex: 1; overflow-y: auto; margin-top: 25px; }
        .nav-btn { width: 100%; padding: 12px 15px; border-radius: 12px; border: none; background: transparent; color: var(--text-main); text-align: left; cursor: pointer; transition: 0.2s; margin-bottom: 8px; font-size: 0.9rem; font-weight: 500; }
        .nav-btn:hover { background: rgba(59, 130, 246, 0.08); color: var(--accent); transform: translateX(5px); }

        .chat-viewport { flex: 1; display: flex; flex-direction: column; background: rgba(255,255,255,0.1); }
        .messages-area { flex: 1; padding: 30px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }
        
        .msg-row { display: flex; width: 100%; }
        .msg-row.bot { justify-content: flex-start; }
        .msg-row.user { justify-content: flex-end; }
        .avatar-chat { width: 40px; height: 40px; border-radius: 50%; margin-right: 12px; flex-shrink: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .bubble { max-width: 80%; padding: 15px 20px; border-radius: 20px; font-size: 0.98rem; line-height: 1.8; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }
        .bot .bubble { background: white; border-top-left-radius: 4px; border: 1px solid #f1f5f9; }
        .user .bubble { background: var(--accent); color: white; border-top-right-radius: 4px; }

        .input-bar { padding: 25px; background: white; border-top: 1px solid #f1f5f9; display: flex; gap: 15px; }
        #user-input { flex: 1; padding: 14px 25px; border-radius: 30px; border: 1px solid #e2e8f0; outline: none; font-size: 1rem; }
        #send-btn { padding: 0 30px; border-radius: 30px; background: #1e293b; color: white; cursor: pointer; border: none; font-weight: 600; }

        @media (max-width: 768px) { .side-panel { display: none; } }
    </style>
</head>
<body>

<div class="glass-container">
    <div class="side-panel">
        <div class="avatar-ring">
            <img src="profile.jpg" class="avatar-main" onerror="this.src='https://via.placeholder.com/100?text=ç§‹'">
        </div>
        <div class="profile-card">
            <h2>ç§‹æ­¦é€»è¾‘</h2>
            <p class="bio">ä¸œå¤§æ–‡ç†äº¤å‰èƒŒæ™¯<br>æœ¬é˜µå®ˆæŠ¤è€… Â· å‡å­¦é˜²å¾¡</p>
        </div>
        <div class="nav-section" id="nav-btns-container"></div>
    </div>
    <div class="chat-viewport">
        <div class="messages-area" id="chat-container"></div>
        <div class="input-bar">
            <input type="text" id="user-input" placeholder="è¾“å…¥å…³é”®è¯ (RP, ç”Ÿæ€, å¾®ä¿¡)...">
            <button id="send-btn" onclick="handleSearch()">å‘é€</button>
        </div>
    </div>
</div>

<script>
    /**
     * V20 æ ¸å¿ƒé€»è¾‘å¼•æ“
     * 1. ç‰©ç†å°è£…æ ¸å¿ƒæ•°æ® (ç¡®ä¿æœ€é«˜ä¼˜å…ˆçº§)
     * 2. æƒé‡åˆ†çº§ç®—æ³•
     * 3. [BREAK] æƒ…æ„ŸèŠ‚å¥æ§åˆ¶
     */
    const MASTER_KNOWLEDGE = [
        {
            "id": "ä¿®å£«æœ¬é˜µ",
            "nav": "ä¿®å£«/ç ”ç©¶ç”Ÿ/å†…è¯º",
            "weight": 100,
            "keys": ["ä¿®å£«", "ç ”ç©¶ç”Ÿ", "å†…è¯º", "å¤§å­¦é™¢", "è€ƒç ”"],
            "data": "<b>ã€å¤§å­¦é™¢ï¼šæ–‡ç†äº¤å‰çš„å®šåˆ¶åŒ–ç ´å±€ã€‘</b> [BREAK] <b>é—®ï¼šä¿®å£«/ç ”ç©¶ç”Ÿç”³è¯·æœ€æ ¸å¿ƒçš„äº¤ä»˜æ˜¯ä»€ä¹ˆï¼Ÿ</b> [BREAK] ç­”ï¼šæ˜¯<b>â€œä¸€é—®ä¸€ç­”å¼é¢è¯•ç­”è¾©è‰ç¨¿â€çš„æ·±åº¦å®šåˆ¶</b>ã€‚ [BREAK] æˆ‘ä»¬åœ¨æ¯ä¸€å¥ç­”è¾©ä¸­æ¤å…¥é˜²å¾¡é€»è¾‘ï¼Œç¡®ä¿é¢å¯¹è¿½é—®æ—¶çš„ç¨³å®šæ€§ã€‚"
        },
        {
            "id": "ç†ç§‘æ ¸å¿ƒ",
            "nav": "ç†ç§‘/ç”Ÿæ€/ç”Ÿç‰©",
            "weight": 100,
            "keys": ["ç†ç§‘", "ç”Ÿæ€", "ç”Ÿç‰©", "ç¯å¢ƒ", "æœ¬é˜µ", "åŒ–å­¦"],
            "data": "<b>ã€ç†ç§‘ä¸ç”Ÿæ€ï¼šæœ¬é˜µçº§æ·±åº¦æ¸—é€ã€‘</b> [BREAK] ç§‹æ­¦è€å¸ˆçš„ä¸œå¤§æ–‡ç†èåˆèƒŒæ™¯ï¼Œå†³å®šäº†æˆ‘ä»¬åœ¨<b>ç ”ç©¶è¯¾é¢˜é€»è¾‘ã€å®éªŒè®¾è®¡é™ˆè¿°</b>ä¸Šæ‹¥æœ‰æ•™æˆè§†è§’çš„ç²¾å‡†åº¦ã€‚ [BREAK] $$R-COOH + R'-OH \\xrightarrow[H_2SO_4]{\\Delta} R-COOR' + H_2O$$"
        },
        {
            "id": "æ–‡ä¹¦é€»è¾‘",
            "nav": "RP/ç†ç”±ä¹¦å®šåˆ¶",
            "weight": 90,
            "keys": ["ç ”ç©¶è®¡åˆ’ä¹¦", "RP", "å¿—æœ›ç†ç”±ä¹¦", "ç†ç”±ä¹¦", "æ–‡ä¹¦", "ä¿®æ”¹"],
            "data": "<b>ã€æ–‡ä¹¦ï¼šé¢è¯•é˜²å¾¡çš„å‰å“¨ç«™ã€‘</b> [BREAK] <b>æ ¸å¿ƒé€»è¾‘ï¼šæ–‡ä¹¦æ˜¯ä¸ºé¢è¯•åŸ‹ä¸‹çš„â€œé€»è¾‘ä¼ç¬”â€ã€‚</b> [BREAK] æˆ‘ä»¬å°† $H_0/H_1$ çš„å‡è®¾é—­ç¯å®Œç¾åµŒå…¥è®¡åˆ’ä¹¦ã€‚æ‰€æœ‰çš„æ¶¦è‰²éƒ½æ˜¯ä¸ºäº†è®©ä½ çš„â€œå”¯ä¸€æ€§â€ç«™å¾—ä½è„šã€‚"
        },
        {
            "id": "è”ç³»ç§‹æ­¦",
            "nav": "è”ç³»ç§‹æ­¦/å¾®ä¿¡",
            "weight": 80,
            "keys": ["å¾®ä¿¡", "è”ç³»", "è´¹ç”¨", "ä»·æ ¼"],
            "data": "<b>ã€ç§‹æ­¦é€»è¾‘ï¼šä¸€é’ˆè§è¡€çš„çœŸå®ç£å¯¼ã€‘</b> [BREAK] <b>å¾®ä¿¡ï¼š</b><b>qiuwu999</b> [BREAK] ç§‹æ­¦è€å¸ˆè™½ç„¶ä¸å¥½åƒï¼Œä½†ä¼šé™ªä½ åƒé€æœ€éš¾çš„é€»è¾‘ï¼ğŸ˜Š"
        }
    ];

    let isTyping = false;

    // ååŒæœç´¢ç®—æ³•
    function synergySearch(query) {
        let best = null, top = 0;
        const q = query.toLowerCase();
        MASTER_KNOWLEDGE.forEach(item => {
            let score = 0;
            if(q.includes(item.id)) score += 50;
            item.keys.forEach(k => { if(q.includes(k.toLowerCase())) score += item.weight; });
            if(score > top) { top = score; best = item; }
        });
        return best;
    }

    async function handleSearch() {
        const input = document.getElementById('user-input');
        const query = input.value.trim();
        if(!query || isTyping) return;
        
        addMessage(query, 'user');
        input.value = "";
        
        const match = synergySearch(query);
        if(match) {
            const segs = match.data.split('[BREAK]').map(s => s.trim());
            for(let i=0; i<segs.length; i++) {
                await typeEffect(segs[i], i === 0);
                await new Promise(r => setTimeout(r, 600));
            }
        } else {
            await typeEffect("è¯¥ç»´åº¦å°šæœªå¯¹é½ã€‚å»ºè®®è¾“å…¥ï¼š<b>RPã€ä¿®å£«ã€æœ¬é˜µ</b> æˆ–å’¨è¯¢ï¼š<b>qiuwu999</b>");
        }
    }

    function addMessage(text, role) {
        const chat = document.getElementById('chat-container');
        const row = document.createElement('div');
        row.className = `msg-row ${role}`;
        row.innerHTML = `<div class="bubble">${text}</div>`;
        chat.appendChild(row);
        chat.scrollTop = chat.scrollHeight;
    }

    function typeEffect(text, avatar) {
        return new Promise(resolve => {
            isTyping = true;
            const chat = document.getElementById('chat-container');
            const row = document.createElement('div');
            row.className = 'msg-row bot';
            row.innerHTML = `${avatar ? '<img src="profile.jpg" class="avatar-chat" onerror="this.src=\'https://via.placeholder.com/40\'">' : '<div style="width:52px"></div>'}<div class="bubble"></div>`;
            chat.appendChild(row);
            const b = row.querySelector('.bubble');
            let i = 0;
            const t = setInterval(() => {
                if(i < text.length) {
                    if(text[i] === '<') { let e = text.indexOf('>', i); b.innerHTML += text.substring(i, e+1); i = e+1; }
                    else { b.innerHTML += text[i]; i++; }
                    chat.scrollTop = chat.scrollHeight;
                } else {
                    clearInterval(t); isTyping = false;
                    if(window.MathJax) MathJax.typesetPromise([b]);
                    resolve();
                }
            }, 12);
        });
    }

    // åˆå§‹åŒ–ååŒç¯å¢ƒ
    function init() {
        const container = document.getElementById('nav-btns-container');
        MASTER_KNOWLEDGE.forEach(item => {
            const btn = document.createElement('button');
            btn.className = 'nav-btn';
            btn.innerText = "âš¡ " + item.nav;
            btn.onclick = () => { if(!isTyping) { addMessage(item.nav, 'user'); handleSearchManual(item); }};
            container.appendChild(btn);
        });
        welcome();
    }

    async function handleSearchManual(item) {
        const segs = item.data.split('[BREAK]').map(s => s.trim());
        for(let i=0; i<segs.length; i++) {
            await typeEffect(segs[i], i === 0);
            await new Promise(r => setTimeout(r, 600));
        }
    }

    async function welcome() {
        await typeEffect("ä½ å¥½ï¼æˆ‘æ˜¯ç§‹æ­¦è€å¸ˆçš„æ•°å­—åŠ©ç†ã€‚ğŸŒ¸", true);
        await new Promise(r => setTimeout(r, 600));
        await typeEffect("å‡å­¦é˜²å¾¡é€»è¾‘åº“ V20 å·²éƒ¨ç½²å®Œæ¯•ã€‚è¯·è¾“å…¥å…³é”®è¯æˆ–ç‚¹å‡»ä¾§è¾¹æ å¼€å§‹é€»è¾‘è¡¥ç¼ã€‚", false);
    }

    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
